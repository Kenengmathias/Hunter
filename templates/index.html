{% extends "base.html" %}

{% block title %}Hunter - Find Your Perfect Job{% endblock %}

{% block content %}
<!-- Search Section -->
<div class="search-container">
    <div class="search-header">
        <h1><i class="fas fa-crosshairs hunter-icon"></i>Hunter Job Search</h1>
        <p>Your omnipresent job hunting companion. Search across multiple platforms instantly.</p>
    </div>

    <form method="POST" id="search-form">
        <div class="row g-3">
            <!-- Job Title Input -->
            <div class="col-md-6">
                <label for="job_title" class="form-label">
                    <i class="fas fa-briefcase me-2"></i>Job Title / Keywords
                </label>
                <input type="text" 
                       class="form-control" 
                       id="job_title" 
                       name="job_title" 
                       placeholder="e.g., Software Developer, Marketing Manager"
                       value="{{ request.form.get('job_title', '') }}"
                       required>
            </div>

            <!-- Location Input -->
            <div class="col-md-6">
                <label for="location" class="form-label">
                    <i class="fas fa-map-marker-alt me-2"></i>Location
                </label>
                <input type="text" 
                       class="form-control" 
                       id="location" 
                       name="location" 
                       placeholder="e.g., Calabar, Lagos, Remote"
                       value="{{ request.form.get('location', '') }}">
            </div>
        </div>

        <!-- Filters Section -->
        <div class="filter-section mt-4">
            <h6><i class="fas fa-filter me-2"></i>Filters</h6>
            <div class="row g-3">
                <!-- Job Type -->
                <div class="col-md-4">
                    <label for="job_type" class="form-label">Job Type</label>
                    <select class="form-select" id="job_type" name="job_type">
                        <option value="all" {{ 'selected' if request.form.get('job_type') == 'all' else '' }}>All Types</option>
                        <option value="fulltime" {{ 'selected' if request.form.get('job_type') == 'fulltime' else '' }}>Full-time</option>
                        <option value="parttime" {{ 'selected' if request.form.get('job_type') == 'parttime' else '' }}>Part-time</option>
                        <option value="contract" {{ 'selected' if request.form.get('job_type') == 'contract' else '' }}>Contract</option>
                        <option value="freelance" {{ 'selected' if request.form.get('job_type') == 'freelance' else '' }}>Freelance</option>
                    </select>
                </div>

                <!-- Max Results -->
                <div class="col-md-4">
                    <label for="max_results" class="form-label">Max Results</label>
                    <select class="form-select" id="max_results" name="max_results">
                        <option value="20" {{ 'selected' if request.form.get('max_results') == '20' else '' }}>20 jobs</option>
                        <option value="40" {{ 'selected' if request.form.get('max_results') == '40' else '' }}>40 jobs</option>
                        <option value="60" {{ 'selected' if request.form.get('max_results') == '60' else '' }}>60 jobs</option>
                        <option value="100" {{ 'selected' if request.form.get('max_results') == '100' else '' }}>100 jobs</option>
                    </select>
                </div>

                <!-- Local Jobs Toggle -->
                <div class="col-md-4">
                    <label class="form-label d-block">Options</label>
                    <div class="form-check">
                        <input class="form-check-input" 
                               type="checkbox" 
                               id="include_local" 
                               name="include_local"
                               {{ 'checked' if request.form.get('include_local') else '' }}>
                        <label class="form-check-label" for="include_local">
                            <i class="fas fa-map-pin me-1"></i>Include Local Jobs
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Button -->
        <div class="text-center mt-4">
            <button type="submit" class="btn btn-hunter btn-lg">
                <i class="fas fa-search me-2"></i>Hunt for Jobs
            </button>
        </div>
    </form>
</div>

<!-- Loading Animation -->
<div id="loading" class="loading">
    <div class="spinner-grow" role="status">
        <span class="visually-hidden">Searching...</span>
    </div>
    <div class="spinner-grow" role="status" style="animation-delay: 0.2s;">
        <span class="visually-hidden">Searching...</span>
    </div>
    <div class="spinner-grow" role="status" style="animation-delay: 0.4s;">
        <span class="visually-hidden">Searching...</span>
    </div>
    <h5 class="mt-3">
        <i class="fas fa-crosshairs hunter-icon"></i>
        Hunting across multiple job platforms...
    </h5>
    <p class="text-muted">This may take a few seconds as we search everywhere for you.</p>
</div>

<!-- Search Results -->
{% if search_performed %}
<div class="results-section">
    {% if jobs %}
        <div class="results-header mb-4">
            <h3><i class="fas fa-bullseye me-2"></i>Found {{ jobs|length }} Jobs</h3>
            <p class="text-muted">Jobs are ranked by relevance to your search criteria.</p>
        </div>

        <!-- Job Cards -->
        <div class="row">
            {% for job in jobs %}
            <div class="col-12">
                <div class="job-card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <!-- Job Title -->
                                <h5 class="card-title">
                                    {% if job.link and job.link != '#' %}
                                        <a href="{{ job.link }}" 
                                           target="_blank" 
                                           class="job-title"
                                           onclick="trackJobClick('{{ job.source }}', '{{ job.title }}')">
                                            {{ job.title }}
                                            <i class="fas fa-external-link-alt ms-1" style="font-size: 0.8rem;"></i>
                                        </a>
                                    {% else %}
                                        <span class="job-title">{{ job.title }}</span>
                                    {% endif %}
                                </h5>

                                <!-- Company and Location -->
                                <div class="mb-2">
                                    {% if job.company %}
                                        <span class="job-company">
                                            <i class="fas fa-building me-1"></i>{{ job.company }}
                                        </span>
                                    {% endif %}
                                    
                                    {% if job.location %}
                                        <span class="job-location ms-3">
                                            <i class="fas fa-map-marker-alt me-1"></i>{{ job.location }}
                                        </span>
                                    {% endif %}
                                </div>

                                <!-- Job Description -->
                                {% if job.description %}
                                <p class="card-text text-muted">
                                    {{ job.description[:150] }}{% if job.description|length > 150 %}...{% endif %}
                                </p>
                                {% endif %}

                                <!-- Job Details -->
                                <div class="job-details">
                                    {% if job.salary %}
                                        <span class="job-salary me-3">
                                            <i class="fas fa-money-bill-wave me-1"></i>{{ job.salary }}
                                        </span>
                                    {% endif %}

                                    {% if job.job_type %}
                                        <span class="job-type-badge me-2">{{ job.job_type }}</span>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="col-md-4 text-md-end">
                                <!-- Source Badge -->
                                <span class="job-source mb-2 d-inline-block">{{ job.source }}</span>
                                
                                <!-- Relevance Score (for debugging) -->
                                {% if job.relevance_score %}
                                <div class="text-muted small">
                                    Relevance: {{ "%.1f"|format(job.relevance_score) }}
                                </div>
                                {% endif %}

                                <!-- Apply Button -->
                                {% if job.link and job.link != '#' %}
                                <div class="mt-2">
                                    <a href="{{ job.link }}" 
                                       target="_blank" 
                                       class="btn btn-outline-primary btn-sm"
                                       onclick="trackJobClick('{{ job.source }}', '{{ job.title }}')">
                                        <i class="fas fa-paper-plane me-1"></i>Apply Now
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Results Summary -->
        <div class="text-center mt-4">
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                Showing {{ jobs|length }} jobs from multiple sources. 
                Try different keywords for more results!
            </div>
        </div>

    {% else %}
        <!-- No Results -->
        <div class="text-center mt-5">
            <div class="alert alert-warning">
                <i class="fas fa-search me-2"></i>
                <h5>No jobs found</h5>
                <p class="mb-0">Try different keywords, expand your location search, or check your spelling.</p>
            </div>
            
            <!-- Search Tips -->
            <div class="mt-4">
                <h6><i class="fas fa-lightbulb me-2"></i>Search Tips:</h6>
                <ul class="list-unstyled">
                    <li>• Try broader job titles (e.g., "Developer" instead of "Senior React Developer")</li>
                    <li>• Include alternative locations or try "Remote"</li>
                    <li>• Check the "Include Local Jobs" option for Nigerian opportunities</li>
                    <li>• Use different variations of your job title</li>
                </ul>
            </div>
        </div>
    {% endif %}
</div>
{% elif not search_performed %}
<!-- Welcome Message for First Visit -->
<div class="welcome-section text-center mt-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h2><i class="fas fa-rocket me-2"></i>Ready to Hunt for Your Dream Job?</h2>
            <p class="lead">Hunter searches across multiple job platforms simultaneously, giving you access to opportunities from:</p>
            
            <div class="row mt-4">
                <div class="col-md-3 col-6 mb-3">
                    <div class="text-center">
                        <i class="fas fa-globe fa-2x text-primary mb-2"></i>
                        <h6>Indeed</h6>
                        <small class="text-muted">Global & Nigeria</small>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-3">
                    <div class="text-center">
                        <i class="fas fa-map-marker-alt fa-2x text-success mb-2"></i>
                        <h6>Jobberman</h6>
                        <small class="text-muted">Nigerian Jobs</small>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-3">
                    <div class="text-center">
                        <i class="fas fa-search fa-2x text-warning mb-2"></i>
                        <h6>JSearch</h6>
                        <small class="text-muted">AI-Powered</small>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-3">
                    <div class="text-center">
                        <i class="fas fa-plus fa-2x text-info mb-2"></i>
                        <h6>More APIs</h6>
                        <small class="text-muted">Jooble & Adzuna</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
    // Enhanced job tracking
    function trackJobClick(source, title) {
        console.log(`Job Application: ${title} from ${source}`);
        
        // You can add analytics tracking here
        // gtag('event', 'job_click', {
        //     'source': source,
        //     'job_title': title
        // });
    }

    // Auto-suggest for locations (placeholder)
    document.addEventListener('DOMContentLoaded', function() {
        const locationInput = document.getElementById('location');
        const nigerianCities = [
            'Lagos', 'Abuja', 'Kano', 'Ibadan', 'Calabar', 'Port Harcourt',
            'Benin City', 'Jos', 'Ilorin', 'Owerri', 'Enugu', 'Abeokuta',
            'Onitsha', 'Warri', 'Sokoto', 'Kaduna', 'Maiduguri', 'Zaria'
        ];
        
        // Simple autocomplete placeholder
        locationInput.addEventListener('input', function() {
            const value = this.value.toLowerCase();
            // This is where you'd implement autocomplete
            // For now, it's just a placeholder for future enhancement
        });
    });
</script>
{% endblock %}
